---
title       : Interpreting portfolio returns 
description : The history of portfolio returns contains valuable information on how much the investor can expect to gain or lose. Investors summarize these numbers graphically in terms of distribution plots and through statics expressing average return, risk and risk-adjusted return over rolling estimation samples. This chapter concludes by an investigation in the non-normality of the return series of investments and provides tools to characterize the financial risks and rewards that that takes this non-normality into account. 

--- type:VideoExercise lang:r xp:50 skills:1
## Evaluating portfolio performance is an estimation problem


*** =video_link
//player.vimeo.com/video/108225030



--- type:MultipleChoiceExercise lang:r xp:50 skills:1
## Balancing risk and reward 

The portfolio return is a random variable. The range of possible outcomes and the likelihood of each of those outcomes can be visualized through the density plots of return distribution. The center of the density plot indicates the return you may expect on average, while the width of the density plot shows you how far off the returns can be from this average return expectation. Throughout, we make the realistic assumption that investors are risk-averse: if two investments offer the same expected return, the investor will prefer the investment with the lowest risk. 

In the right panel, you see see the density plots for the returns on three possible investments. The returns in the upper and middle panel have the same mean. The returns in the upper and bottom plot have the same standard deviation. Which distribution is to be preferred? 

*** =instructions
- Distribution in the upper plot.
- Distribuion in the middle plot.
- Distribution in the lower plot.

*** =hint
hint

*** =pre_exercise_code
```{r}
# pec
par(mfrow=c(3,1),mar=c(3,3,1,1),cex.axis=1.2)
vx = seq(-0.5,0.5,0.001)
plot( vx , dnorm(vx,mean=0,sd=0.10),type="l")
abline(v=0,lty=3)
plot( vx , dnorm(vx,mean=0,sd=0.20),type="l")
abline(v=0,lty=3)
plot( vx , dnorm(vx,mean=0.10,sd=0.10),type="l")
abline(v=0.10,lty=3)
```

*** =sct
```{r}
test_mc(3) # if 3 is the correct option.
```

--- type:NormalExercise lang:r xp:100 skills:1
## The returns on the S&P 500 portfolio

In practice, the mean and standard deviation of the returns is unknown and needs to be estimated, e.g. using the sample mean and standard deviation. Let us now use the functions `mean` and `sd` to estimate the mean and standard deviation on a US equity portfolios. 

Of all possible portfolios, we consider here the most common choice in US equities investing, namely the S&P 500 portfolio, which invests in the 500 largest publicly listed US stocks and set weights proportional to the stocks' market capitalization.

In the graphics envioronment, you can see the time series plot for the end-of-month value evolution in the top figure and the time series plot of monthly returns in the bottom figure. These returns are available in the R console as the variable `sp500_returns`.

*** =instructions
- Compute the mean value of the return series.
- Compute the standard deviation of the return series. 
- Compute the risk-adjusted return given by the mean return divided by the standard deviation.
- Use the function [table.CalandarReturns](http://www.rdocumentation.org/packages/PerformanceAnalytics/functions/table.CalandarReturns) in PerformanceAnalytics to present the monthly return data in the visually attractive format year x month. 
*** =hint


*** =pre_exercise_code
```{r}
# pec
options(warn=-1)
library(tseries)# Its function get.hist.quote allows to download prices from Yahoo!Finance
library(xts) # Its function plot.zoo make simple, but attractive, time series plots
# download adjusted close prices (that is corrected for dividend payments and stock splits)
# dates have the format "YYYY-MM-DD"
sp500 <- get.hist.quote(instrument="^GSPC",start=as.Date("1950-12-31"),end=Sys.Date(),quote="AdjClose",quiet=T,compression="m")
library(PerformanceAnalytics)
sp500_returns <-  xts(CalculateReturns(sp500))[-1]
names(sp500_returns) <- "sp500"
par(mfrow=c(2,1),mar=c(3,2,2,2),cex.axis=0.7)
plot.zoo(sp500 , main="Value of the S&P 500 portfolio",ylab="", xlab="")
plot.zoo(sp500_returns , main="Monthly returns of the S&P 500 portfolio",ylab="", xlab="",type="h")
```

*** =sample_code
```{r}
# Compute the mean monthly returns 

# Compute the standard deviation
  
# Compute the mean return divided by the return standard deviation

# Produce the year x month table

```

*** =solution
```{r}
# Compute the mean monthly returns 
mean(sp500_returns)
# Compute the standard deviation
sd(sp500_returns)  
# Compute the mean return divided by the return standard deviation
mean(sp500_returns)/sd(sp500_returns)
# Produce the year x month table
table.CalendarReturns(sp500_returns)
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```



--- type:NormalExercise lang:r xp:100 skills:1
## Annualized mean and volatility

The mean and volatility of monthly returns corresponds to the average and standard deviation over a monthly investment horizon. Investors annualize those statistics by mutiplying the mean with 12, and the volatility with the square root of twelve. Compute the annualized mean and volatility of the portfolios.

*** =instructions
- Print the annualized mean of `sp500_returns`.
- Print the annualized standard deviation of `sp500_returns`.
- Assume the risk free rate is 0. What is the portfolio's Sharpe ratio?
- Verify that the functions [Return.annualized](http://www.rdocumentation.org/packages/PerformanceAnalytics/functions/Return.annualized), [StdDev.annualized](http://www.rdocumentation.org/packages/PerformanceAnalytics/functions/StdDev.annualized)  and [table.AnnualizedReturns](http://www.rdocumentation.org/packages/PerformanceAnalytics/functions/table.AnnualizedReturns) report the same numbers.
*** =hint
hint comes here

*** =pre_exercise_code
```{r}
options(warn=-1)
library(tseries)# Its function get.hist.quote allows to download prices from Yahoo!Finance
library(xts) # Its function plot.zoo make simple, but attractive, time series plots
# download adjusted close prices (that is corrected for dividend payments and stock splits)
# dates have the format "YYYY-MM-DD"
sp500 <- get.hist.quote(instrument="^GSPC",start=as.Date("1950-12-31"),end=Sys.Date(),quote="AdjClose",quiet=T,compression="m")
library(PerformanceAnalytics)
sp500_returns <-  xts(CalculateReturns(sp500))[-1]
names(sp500_returns) <- "sp500"
```

*** =sample_code
```{r}
# Annualized mean

# Annualized standard deviation

# Same answer?

```

*** =solution
```{r}
# Annualized mean
12*mean(sp500_returns)
# Annualized standard deviation
sqrt(12)*sd(sp500_returns)
# Same answer?
Return.annualized(sp500_returns)
StdDev.annualized(sp500_returns)
table.AnnualizedReturns(sp500_returns)
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1
## The annualized Sharpe ratio

The Sharpe ratio is the average excess return per unit of portfolio volatility. Suppose the average excess return and portfolio volatility are computed on monthly returns. What is the effect of using annualized mean excess returns and volatility on the Sharpe ratio? 

*** =instructions
- The annualized Sharpe ratio and the monthly Sharpe ratio are identical.
- The annualized Sharpe ratio is 12 times the monhtly Sharpe ratio.
- The annualized Sharpe ratio is $\sqrt{12}$ times the monhtly Sharpe ratio.

*** =hint
hint

*** =pre_exercise_code
```{r}
# pec

```

*** =sct
```{r}
test_mc(3) # if 3 is the correct option.
```


--- type:NormalExercise lang:r xp:100 skills:1
## Don't be fooled by randomness

It is important to be aware of the limitations of estimation. It is almost sure that the estimates of the mean and volatility will be different from the true mean and standard deviation.

Familiarize now yourself with the uncertainty in estimation by drawing random samples from a normal distribution with mean of 5% and standard deviation of 10%, and how this uncertainty is reduced when the sample size grows.  

*** =instructions
-  Set the variable `returns` to the sample of 12 observations obtained by using the function `rnorm` to sample from the normal  distribution with mean 5% and standard deviation of 10%.  
- Compute the mean and standard deviation of the return series. 
- Repeat the first two instructions and see how different the numbers are for a different sample. 
- Repeat the first three instructions but for a sample of 60 observations.  
*** =hint


*** =pre_exercise_code
```{r}
# pec

```

*** =sample_code
```{r}
# Draw the random sample

# Compute the mean and standard deviation
  
# Repeat the above

# Repeat the above for a sample of 1000 observations

```

*** =solution
```{r}
# Draw the random sample
returns <- rnorm(12,mean=0.05,sd=0.10)
# Compute the mean and standard deviation
mean(returns)
sd(returns)
# Repeat the above
returns <- rnorm(12,mean=0.05,sd=0.10)
mean(returns)
sd(returns)
# Repeat the above for a sample of 1000 observations
returns <- rnorm(60,mean=0.05,sd=0.10)
mean(returns)
sd(returns)
returns <- rnorm(60,mean=0.05,sd=0.10)
mean(returns)
sd(returns)
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:VideoExercise lang:r xp:50 skills:1
## Time-variation in portfolio performance

Time-variation in the return distribution. Not all information is equally predicitve. discuss  of time-variation in average return and volatility. Use of rolling window analysis to visualize this.
*** =video_link
//player.vimeo.com/video/108225030

--- type:NormalExercise lang:r xp:100 skills:1
## Rolling annualized mean and volatility

charts.RollingPerformance on the portfolio return vector

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
preturns <- Return.portfolio( returns )
```

*** =sample_code
```{r}
# sample code
chart.RollingPerformance(R=preturns , width=12,
                         FUN="Return.annualized",scale=12)
chart.RollingPerformance(R=preturns , width=12,
                         FUN="sd.annualized",scale=12)
```

*** =solution
```{r}
# solution code
chart.RollingPerformance(R=preturns , width=12,
                         FUN="Return.annualized",scale=12)
chart.RollingPerformance(R=preturns , width=12,
                         FUN="sd.annualized",scale=12)
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1
## Effect of window length choice

I show two plots, one with rolling windows of 6 months and one with rolling windows of 12 months. Which one is more persistent?

*** =instructions
- Annualized volatility on rolling window of 6 months
- Annualized volatility on rolling window of 12 months

*** =hint
hint

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
preturns <- Return.portfolio( returns )
par(mfrow = c(2,1))
chart.RollingPerformance(R=preturns , width=6,
                         FUN="sd.annualized",scale=12)
chart.RollingPerformance(R=preturns , width=12,
                         FUN="sd.annualized",scale=12)
```

*** =sct
```{r}
test_mc(2) # if 2 is the correct option.
```

--- type:NormalExercise lang:r xp:100 skills:1
## Subset a zoo/xts time series using the function window and compare performance on a normal versus crisis period

Let us now consider the time-variation in the return distribution. Define `preturns.2008` as the portfolio returns in 2008, obtained
with the function `window`, having as first argument the return series that needs to be subset, then the start data and end date
in the format `YYYY-MM-DD`. Compare the histogram of `preturns` with `preturns.2008` and well as the annualized volatility. 


*** =instructions
-  Define `preturns.2008`
-  Plot the histograms
-  Commpute annualized volatility

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
preturns <- Return.portfolio( returns )
DJIA <- cumprod(1+preturns)
```

*** =sample_code
```{r}
# Define preturns.2008
preturns.2008 <- window(preturns,startdate = as.Date(" "), enddate = as.Date(" ")  )
# plotting
par( mfrow = c(2,1) , mar=c(3,2,2,2))

# annualized volatility

```

*** =solution
```{r}
# solution code
# Define preturns2008
preturns2008 <- window(preturns,startdate = as.Date("2008-01-01"), enddate = as.Date("2008-12-31 ")  )
# plotting
par( mfrow = c(2,1) , mar=c(3,2,2,2))
hist(preturns2008)
hist(preturns)
# annualized volatility
sqrt(12)*sd(preturns2008)
sqrt(12)*sd(preturns)         

```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:NormalExercise lang:r xp:100 skills:1
## Analyzing the portfolio return distribution

The variable `preturns` contains the monthly returns on the equally-weighted portfolio of Dow Jones Industrial Average stocks over the period 1991-2015. Compute first the mean and standard deviation of these returns, as well as their minimum and maximum value. Then plot the histogram of these returns.

*** =instructions
- Compute summary statistics using the functions `mean`, `sd`, `min` and `max`
- Plot the histogram and expriment with the argument `breaks` in `hist` to make the intervals smaller

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
preturns <- Return.portfolio( returns )
```

*** =sample_code
```{r}
# Summary statistics




# Histogram


```

*** =solution
```{r}
# Summary statistics
mean(preturns)
sd(preturns)
min(preturns)
max(preturns)
# Histogram
hist(preturns,breaks=10)
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```





--- type:VideoExercise lang:r xp:50 skills:1
## Downside risk; skewness, kurtosis and value-at-risk


*** =video_link
//player.vimeo.com/video/108225030

--- type:NormalExercise lang:r xp:100 skills:1
## Non-normality in the return distribution

Exercise on computing skewness, kurtosis.

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
preturns <- Return.portfolio( returns )
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:NormalExercise lang:r xp:100 skills:1
## Downside risk measures

The use of the VaR function to compute value at risk.

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
preturns <- Return.portfolio( returns )
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:NormalExercise lang:r xp:100 skills:1
## Drawdowns

The use of the table.Drawdowns function in PerformanceAnalytics.

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
preturns <- Return.portfolio( returns )
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:NormalExercise lang:r xp:100 skills:1
## The effect of leverage

Suppose that by leveraging the portfolio, the returns are multiplied by 2. Verify that the mean and standard deviation of the leveraged returns is twice the mean and standard deviation of the original returns and that the skewness and kurtosis are not affected by the levarage. 

*** =instructions
- Define the variable `lpreturns`
- Compute for `preturns` and `lpereturns` the vector holding the mean, standard deviation, skewness and kurtosis



*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
preturns <- Return.portfolio( returns )
```

*** =sample_code
```{r}
# Define lpreturns

# Vector with mean, sd, skewness and excess kurtosis for preturns
c(  ,   ,   ,  )
# Vector with mean, sd, skewness and excess kurtosis for lpreturns
c(  ,   ,   ,  )
```

*** =solution
```{r}
# Define lpreturns
lpreturns = 2*preturns
# Vector with mean, sd, skewness and excess kurtosis for preturns
c(  mean(preturns) , sd(preturns)   , skewness(preturns)  , kurtosis(preturns)  )
# Vector with mean, sd, skewness and kurtosis for lpreturns
c(  mean(lpreturns) , sd(lpreturns)   , skewness(lpreturns)  , kurtosis(lpreturns)  )
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```


