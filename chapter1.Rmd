---
title       : The building blocks
description : Asset returns and portfolio weights; those are the building blocks of a portfolio return. In this chapter, you will first learn about computing portfolio weights in R. Next we will see how to combine portfolio weights and asset returns into the calculation of portfolio returns. The exercises involve both simple two-asset cases and a real-life portfolio invested in the 30 Dow Jones Industrial Average stocks. The final exercises consist in linking portfolio returns to the nominal portfolio value and doing a multi-period analysis.   

--- type:VideoExercise lang:r xp:50 skills:1
## The power of portfolio diversification

*** =video_link
//player.vimeo.com/video/108225030

--- type:NormalExercise lang:r xp:100 skills:1
## Calculating portfolio weights when component values are given

An investor has  4000 USD invested in equities, 4000 USD in bonds and 2000 USD in commodities. In order to compute the corresponding portfolio weights, define the vector `values` as the vector holding these three values. Then define the vector `weights` as the vector `values` divided by the total value (obtained by summing over the component values using the function `sum`).

*** =instructions
- Define the vector `values`.
- Define the vector `weights`.
- Print the vector `weights`.

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
```

*** =sample_code
```{r}
# Define the vector values

# Define the vector weights

# Print the resulting weights
```

*** =solution
```{r}
# Define the vector values
values <- c(4000,2000,2000)
# Define the vector weights
weights <- values/sum(values)
# Print the resulting weights
print(weights)
```

*** =sct
```{r}
# sct code
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1
## Defining the weights of an equally weighted portfolio

The equally weighted portfolio is one of the most used portfolios. Suppose the portfolio is equally invested in $N$ assets. Let `N <- 100`. Which of the following commands does not define properly the weights for the equally-weighted portfolio.  

*** =instructions
- `weights <- rep(1,N)/N`
- `weights <- 1/N`
- `weights <- rep(1/N,N)`

*** =hint
The function `rep(arg1,arg2)` creates a vector in which `arg1` is replicated `arg2` times. 

*** =pre_exercise_code
```{r}
# pec
```

*** =sct
```{r}
test_mc(2) # if 2 is the correct option.
```

--- type:NormalExercise lang:r xp:100 skills:1
## Defining the weights of a characteristic-based portfolio

In a characteristic-based portfolio, the weight is given by the asset's characteristic value divided by the sum of the characteristic values of all assets. A typical example is a market capitalization weighted portfolio such as the S&P 500 invested in the 500 largest companies listed on the US stock exchanges (NYSE, Nasdaq). The stock's weight in the S&P 500 is the stock's market capitalization, dividided by the total market capitalization of all 500 stocks. Note that dividing by the total value of the characteristic across all assets guarantees that the portfolio weights sum up to unity. 

As an exercise, define the vector `characteristics` as the sequence from 1 to 500 and compute the corresponding characteristic-based portfolio weights. Inspect the distribution of the portfolio weights using the function `summary()`.

*** =instructions
- Define `characteristics`
- Define `weights`
- Print `summary(weights)`

*** =hint
`seq(arg1,arg2)` yields a vector holding elements `arg1, arg1+1, arg1+2,...,arg2`.

*** =pre_exercise_code
```{r}
# pec
```

*** =sample_code
```{r}
# Define characteristics

# Compute the weights

# Inspect summary statistics

```

*** =solution
```{r}
# Define characteristics
characteristics <- seq(1,500)
# Compute the weights
weights <- characteristics/sum(characteristics)
# Inspect summary statistics
print(summary(weights))
```

*** =sct
```{r}
# sct code
```


--- type:VideoExercise lang:r xp:50 skills:1
## Portfolio returns are the weighted average of the individual returns


*** =video_link
//player.vimeo.com/video/108225030

--- type:NormalExercise lang:r xp:100 skills:1
## Calculation of portfolio returns

As first exercise, we verify that the portfolio return can be computed as the weighted average of the component returns. We do this for the simple case of three assets and assume the porfolio weights to be value-weighted. 

Assume further that the initial vector of component values is given by `in.values <- c(1000,5000,2000)`. We further suppose that the value changes to `fin.values <- c(1100,4500,3000)`. Define the value weighted portfolio weights as `weights.vw <- in.values/sum(in.values)` compute the component returns using the formula of simple returns. Verify that the weighted average portfolio return ( `sum(in.weights*returns)`  ) equals the percentage change in the total portfolio value ( `sum(fin.values)-sum(in.values))/sum(in.values)` ).

*** =instructions
- Use the simple return definition to compute the vector of returns on the three component assets
- Use the portfolio return formula to compute the (simple) portfolio return

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
```

*** =sample_code
```{r}
# Initial and final values of the assets
in.values <- c(1000,5000,2000)
fin.values <- c(1100,4500,3000)
# Compute simple returns 
returns <- (fin.values-in.values)/in.values
# Compute value weighed portolio weights
weights.vw <- in.values/sum(in.values)
# Compute portfolio return using the portfolio return formula
preturns.vw <- 
# Verify that it matches with the percentage change in the portfolio value
( preturns.vw == (sum(fin.values)-sum(in.values))/sum(in.values) )
```

*** =solution
```{r}
# Initial and final values of the assets
in.values <- c(1000,5000,2000)
fin.values <- c(1100,4500,3000)
# Compute simple returns 
returns <- 
# Compute value weighed portolio weights
weights.vw <- in.values/sum(in.values)
# Compute portfolio return using the portfolio return formula
preturns.vw <- sum(weights.vw*returns)
# Verify that it matches with the percentage change in the portfolio value
( preturns.vw == (sum(fin.values)-sum(in.values))/sum(in.values) )
```

*** =sct
```{r}
# sct code
```

--- type:NormalExercise lang:r xp:100 skills:1
## Log-return do not aggregate into portfolio returns

An alternative definition of return used in finance is log-returns. Let us now verify that, for the same example, log-returns do not have the portfolio aggregation property.  Define `logreturns <- log(fin.values)-log(in.values)` as the vector holding the log-returns of the three component assets. Verify that the weighted average portfolio return ( `sum(in.weights*logreturns)`  ) does not equal the log-return computed on the total portfolio value (`log(sum(fin.values))-log(sum(in.values))`). 

*** =instructions
- Define the vector of log-returns
- Compute the value weighted portfolio returns

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
```

*** =sample_code
```{r}
# Initial and final values of the assets
in.values <- c(1000,5000,2000)
fin.values <- c(1100,4500,3000)
# Compute simple returns 
log.returns <- 
# Compute value weighed portolio weights
weights.vw <- in.values/sum(in.values)
# Compute portfolio return using the portfolio return formula
preturns.vw <- 
# Verify that it matches with the percentage change in the portfolio value
( preturns.vw == (sum(fin.values)-sum(in.values))/sum(in.values) )
```

*** =solution
```{r}
# Initial and final values of the assets
in.values <- c(1000,5000,2000)
fin.values <- c(1100,4500,3000)
# Compute simple returns 
log.returns <- log(fin.values) - log(in.values)
# Compute value weighed portolio weights
weights.vw <- in.values/sum(in.values)
# Compute portfolio return using the portfolio return formula
preturns.vw <- sum( weights.vw * log.return )
# Verify that it matches with the percentage change in the portfolio value
( preturns.vw == (sum(fin.values)-sum(in.values))/sum(in.values) )
```

*** =sct
```{r}
# sct code
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1
## Defining the portfolio returns for an equally weighted portfolio

Below you find three commands to compute the portfolio return of an equally weighted portfolio of `N <- 100` assets with return vector `returns`. Which command is wrong? 

*** =instructions
- `preturn.ew <- mean( returns )`
- `preturn.ew <- sum( rep(1/N,N)*returns )`
- `preturn.ew <- rep( mean(returns),N )`

*** =hint
The portfolio return is a single number. 

*** =pre_exercise_code
```{r}
# pec
```

*** =sct
```{r}
test_mc(2) # if 2 is the correct option.
```

--- type:VideoExercise lang:r xp:50 skills:1
## A time series of portfolio returns


*** =video_link
//player.vimeo.com/video/108225030

--- type:NormalExercise lang:r xp:100 skills:1
## From prices to returns and the equally weighted portfolio return

Convert the DJIA price data into a return data. Use head( ) and tail( ) to print the first 6 and last 6 rows. Use table.CalandarReturns in PerformanceAnalytics to present as month x year.

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
# load djia data
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
```

--- type:NormalExercise lang:r xp:100 skills:1
## The equally weighted portfolio return

The equally  weighted portfolio has the return equal to the average. use rowMeans( ) to compute it and make a  time series plot.

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
```

--- type:NormalExercise lang:r xp:100 skills:1
## Portfolio value

Portfolio value as compounded gross returns. The function cumprod.

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1
## The asymmetric impact of gains and losses.

Assume an investor with portfolio value 100 has a loss of 50%. What is the return needed to be at par again? 

*** =instructions
- 50%
- 100%
- 200%

*** =hint
hint

*** =pre_exercise_code
```{r}
# pec
```

*** =sct
```{r}
test_mc(2) # if 2 is the correct option.
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1
## The asymmetric impact of gains and losses.

Assume an investor with portfolio value 100 has a gain of 50%. How much must she lose to be at par again? 

*** =instructions
- 33.33%
- 50%


*** =hint
hint

*** =pre_exercise_code
```{r}
# pec
```

*** =sct
```{r}
test_mc(2) # if 2 is the correct option.
```



