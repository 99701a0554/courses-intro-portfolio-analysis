---
title       : Optimizing the portfolio 
description : We have up to now considered the portfolio weights as given. Here we consider optimizing the portfolio weights. Markowitz mean variance optimized portfolios.


--- type:MultipleChoiceExercise lang:r xp:50 skills:1   key:139d7eabbd827860709b29f2a8d968614d1e3cb0
## Investing in the DJIA stocks based on their mean and variance

In the workspace, you see a scatter plot showing the mean and standard deviation of the 30 Dow Jones Industrial Average stocks, as estimated on their monthly returns over the period 1991-2015. Each of the stocks is identified in the plot using
its ticker. 

Assume an investor who only cares about the mean and variance of the portfolio return distribution. She likes expected returns and dislikes variance.  Which of the following statements is false:

*** =instructions
- If a mean-variance investor has to invest all her wealth in one asset, then the opportunity of investing in Home Depot (ticker: HD) dominates an investment in Caterpillar (ticker: CAT) since it has a higher average return and lower risk.  
- A mean-variance investor will never combine investments in Home Depot and Caterpillar in her portfolio. 
- By combining investments, it may be possible to obtain a portfolio with a lower variance than the variance of the Exxon Mobil Corporation's stock (ticker: XOM). 
- If an investor is not allowed to borrow, then there is no portfolio invested in thirty Dow Jones Industrial Average stocks, offering a higher average return than the one of Apple (ticker: AAPL).   

*** =hint
hint

*** =pre_exercise_code
```{r}
# pec
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
# load("prices.Rdata")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]

stockmu = apply( X = returns , MARGIN = 2 , FUN="mean")
stocksd = apply( X = returns , MARGIN = 2 , FUN="sd")

# make the scatter plot and add tickers

plot(stocksd,stockmu,col="gray" , xlab="Standard deviation (monthly)", ylab="Average return (monthly)",xlim=c(0,1.1*max(stocksd)),ylim=c(0,1*1*max(stockmu)))
text( stocksd ,  stockmu ,  labels=colnames(returns ), cex= 0.7)
text( stocksd[c("HD","CAT","XOM","AAPL")]  ,  stockmu[c("HD","CAT","XOM","AAPL")] ,  labels=  c("HD","CAT","XOM","AAPL") , cex= 0.9,col="red")
```

*** =sct
```{r}
test_mc(2) # if 2 is the correct option.
```

--- type:NormalExercise lang:r xp:100 skills:1  
## Exploring further the monthly returns of the 30 DJIA stocks 

The 1991-2015 monthly returns on the 30 DJIA stocks are available in the workspace as the variable `returns`.

The scatter plot of the average returns on there is a lot of variation in the average return and volatility across stocks. It also easy to verify that while the average correlation between the stock return is positive Obtain the optimized portfolio weights using portfolio.optim(), plot the portfolio weights using barplot()

*** =instructions
- Verify that `returns` is an object of the xts-class using the function `class`.
- Plot the row means of `returns` (in other words, the returns on the monthly rebalanced equally-weighted  portfolio returns). 
- Plot the histogram of the correlations between the monthly returns of the DJIA stocks. Because of the symmetry of the correlation matrix, you only need the lower triangular elements, which, for any square matrix `Z`, you can select using `Z[lower.tri(Z)]`.
*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
# load("prices.Rdata")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
```

*** =sample_code
```{r}
# returns is pre-loaded
# class of returns

# plot ew portfolio returns

# histogram of correlations

```

*** =solution
```{r}
# returns is pre-loaded
# class of returns
class(returns)
# plot ew portfolio returns
plot.zoo(rowMeans(returns))
# histogram of correlations
Z <- cor(returns)
hist(Z[lower.tri(Z)])
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```


--- type:VideoExercise lang:r xp:50 skills:1 key:2d45c303bc2e49767a9cd744f15a31938a2ec7d9
## Modern portfolio theory of Harry Markowitz


*** =video_link
//player.vimeo.com/video/108225030



--- type:NormalExercise lang:r xp:100 skills:1 key:c066b2d5f610d13afdb48831249d18142590def7
## Find the mean-variance efficient portfolio with target equal to EW (step i)

Obtain the optimized portfolio weights using portfolio.optim(), plot the portfolio weights using barplot()

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
# load("prices.Rdata")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:NormalExercise lang:r xp:100 skills:1 key:6f3df5bc7125d675f226ddc4c69639e2cf24d23c
## Find the mean-variance efficient portfolio with target equal to EW (step ii)

Interpretation of the output (achieved mean return, portfolio variance).

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
# load("prices.Rdata")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:VideoExercise lang:r xp:50 skills:1 key:461436d2ee4b426f97b3c95b6ee39836ae38b34f
## Efficient frontier

Concept of minimizing variance given a sequence of return targets starting from the lowest to highest expected returns
*** =video_link
//player.vimeo.com/video/108225030

--- type:NormalExercise lang:r xp:100 skills:1 key:2c03a87fc29fb66e35d8cdbf244b3dcf41305824
## Plotting the efficient frontier in R using a loop (step i)

Define the grid of target returns. Initialize the portfolio weights, means and sd to be saved.

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
# load("prices.Rdata")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:NormalExercise lang:r xp:100 skills:1 key:5cd26622b81e29df3e9a1636d88d48ed0ae3c3c5
## Plotting the efficient frontier in R using a loop (step ii)

Write the loop. for(), portfolio.optim()

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
# load("prices.Rdata")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:NormalExercise lang:r xp:100 skills:1 key:c0483cbbf9a142a2e4541614bbeb9b8b407328d5
## plotting the efficient frontier in R using a loop (step iii)

WPlot the results

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
# load("prices.Rdata")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:VideoExercise lang:r xp:50 skills:1 key:ca405aabc3c21c142aaae409da6302b77b5210ef
## In-sample versus out-of-sample evalution


*** =video_link
//player.vimeo.com/video/108225030

--- type:NormalExercise lang:r xp:100 skills:1 key:69f72e3a22916ec2ef924a7f212d354f28022366
## Split sample in two and compare realized returns and volatilities of assets with predicted ones

Estimation window, out of sample evaluation window. Estimation error

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
# load("prices.Rdata")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code

# Splitting return data in sample for estimation and out of sample evaluation 
returns.estim = window(returns, start = "2004-01-01", end = "2011-12-31")
returns.oos = window(returns, start ="2012-01-01", end = "2015-03-31")

```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:NormalExercise lang:r xp:100 skills:1 key:6d3bdc717d87317d8c4ccf468836039b35f78440
## Split sample in two and compare EW vs Inverse vol vs mean variance optimized portfolio

Estimation window, out of sample evaluation window. Compare in sample estimated performance with out of sample realized performance.

*** =instructions
- instruction 1
- instruction 2

*** =hint
hint comes here

*** =pre_exercise_code
```{r}
# pec
library(xts)
library(PerformanceAnalytics)
download.file("http://s3.amazonaws.com/assets.datacamp.com/course/portfolio-analysis/prices.rds", destfile="prices.rds")
# load("prices.Rdata")
prices<- readRDS("prices.rds") 
returns <- CalculateReturns(prices, method="simple")
returns <- returns[(-1),]
```

*** =sample_code
```{r}
# sample code
```

*** =solution
```{r}
# solution code
```

*** =sct
```{r}
# sct code
success_msg("Well done!")
```

--- type:VideoExercise lang:r xp:50 skills:1 key:75eb737c24e2ba235ee1de43c66a6324a9282b08
## Main take-aways

summary and extensions.
*** =video_link
//player.vimeo.com/video/108225030

